<div class="box box-default">
  <!-- <h1>{{deliveryNotesForm.value | json}}</h1> -->
  <form [formGroup]="deliveryNotesForm" novalidate>
    <div class="row mt-3">
      <div class="col-md-6">
        <fieldset>
          <legend>Delivery Details</legend>
          <div class="col-md-12 col-sm-6 col-xs-6">
            <div class="form-group">
              <label>Delivery Head</label> <sup>*</sup>
              <input
                type="text"
                class="form-control"
                formControlName="Title"
                accSwiftFormValidator
              />
            </div>
          </div>
          <div class="col-md-12 col-sm-6 col-xs-6">
            <div class="form-group">
              <label>Order Date</label> <sup>*</sup>
              <input
                type="text"
                class="form-control"
                formControlName="OrderDate"
                bsDatepicker
                accSwiftFormValidator
              />
              <span class="glyphicon glyphicon-calendar calendar-icon"></span>
            </div>
          </div>
          <div class="col-md-12 col-sm-6 col-xs-6">
            <div class="form-group">
              <label>Delivery Date</label> <sup>*</sup>
              <input
                type="text"
                class="form-control"
                formControlName="DeliveryDate"
                bsDatepicker
                accSwiftFormValidator
              />
              <span class="glyphicon glyphicon-calendar calendar-icon"></span>
            </div>
          </div>
          <div class="col-md-12 col-sm-6 col-xs-6">
            <div class="form-group">
              <label>Delivered By</label> <sup>*</sup>
              <input
                type="text"
                class="form-control"
                formControlName="DeliveredBy"
                accSwiftFormValidator
              />
            </div>
          </div>
          <div class="col-md-12 col-sm-6 col-xs-6">
            <div class="form-group">
              <label>Deliver Contact</label> <sup>*</sup>
              <input
                type="text"
                class="form-control"
                formControlName="DeliverContact"
                accSwiftFormValidator
              />
            </div>
          </div>
        </fieldset>
      </div>

      <div class="col-md-6">
        <fieldset>
          <legend>Client Details</legend>
          <div class="col-md-12 col-sm-6 col-xs-6">
            <div class="form-group">
              <label>Client Name</label> <sup>*</sup>
              <kendo-dropdownlist
                class="form-control"
                [data]="ledgerList"
                [filterable]="true"
                [textField]="'CodeName'"
                [valueField]="'LedgerName'"
                formControlName="ClientName"
                [valuePrimitive]="true"
                (filterChange)="ledgerDDFilter($event)"
              >
                <ng-template kendoDropDownListItemTemplate let-dataItem>
                  <span class="template">{{ dataItem.CodeName }} </span>
                </ng-template>
                <ng-template kendoDropDownListNoDataTemplate>
                  <div>
                    No data found.
                    <br />
                  </div>
                </ng-template>
              </kendo-dropdownlist>
            </div>
          </div>
          <div class="col-md-12 col-sm-6 col-xs-6">
            <div class="form-group">
              <label>Client Address</label>
              <input
                type="text"
                class="form-control"
                formControlName="ClientAddress"
                accSwiftFormValidator
              />
            </div>
          </div>
          <div class="col-md-12 col-sm-6 col-xs-6">
            <div class="form-group">
              <label>Client Contact</label>
              <input
                type="text"
                class="form-control"
                formControlName="ClientContact"
                accSwiftFormValidator
              />
            </div>
          </div>
          <div class="col-md-12 col-sm-6 col-xs-6">
            <div class="form-group">
              <label>Client PAN/VAT</label>
              <input
                type="text"
                class="form-control"
                formControlName="ClientPAN"
                accSwiftFormValidator
              />
            </div>
          </div>
          <div class="col-md-12 col-sm-6 col-xs-6">
            <div class="form-group">
              <label>Client Email</label>
              <input
                type="email"
                class="form-control"
                formControlName="ClientEmail"
                accSwiftFormValidator
              />
            </div>
          </div>
        </fieldset>
      </div>
    </div>

    <div class="box-body">
      <div class="col-md-12 p-0">
        <div class="grid-wrapper">
          <kendo-grid [data]="productArray.value">
            <ng-template kendoGridToolbarTemplate>
              <button kendoGridAddCommand>Add New Product</button>
            </ng-template>
            <kendo-grid-column field="ProductCode" title="Code" width="80">
              <ng-template
                kendoGridCellTemplate
                let-dataItem="dataItem"
                let-column="column"
                let-formGroup="formGroup"
                let-isNew="isNew"
                let-column="column"
                let-rowIndex="rowIndex"
              >
                <kendo-autocomplete
                  class="form-control"
                  [formControl]="productArray.controls[rowIndex].get(column.field)"
                >
                </kendo-autocomplete>
              </ng-template>
            </kendo-grid-column>
            <kendo-grid-column
              field="ProductName"
              title="Product Name"
              width="150"
            >
              <ng-template
                kendoGridCellTemplate
                let-dataItem="dataItem"
                let-column="column"
                let-formGroup="formGroup"
                let-isNew="isNew"
                let-rowIndex="rowIndex"
              >
                <div class="form-group mt-4">
                  <div class="col-md-11 pl-0">
                    <kendo-dropdownlist
                      class="form-control"
                      [data]="productList"
                      [filterable]="true"
                      [textField]="'CodeName'"
                      [valueField]="'ProductID'"
                      [formControl]="productArray.controls[rowIndex].get(column.field)"
                      [valuePrimitive]="true"
                      (filterChange)="productDDFilter($event, rowIndex)"
                      (valueChange)="handleProductChange($event, rowIndex)"
                    >
                      <ng-template kendoDropDownListItemTemplate let-dataItem>
                        <span class="template">{{ dataItem.CodeName }} </span>
                      </ng-template>
                    </kendo-dropdownlist>
                  </div>
                </div>
              </ng-template>
            </kendo-grid-column>

            <kendo-grid-column
              field="GeneralName"
              title="General Name"
              width="130"
            >
              <ng-template
                kendoGridCellTemplate
                let-dataItem="dataItem"
                let-column="column"
                let-formGroup="formGroup"
                let-rowIndex="rowIndex"
              >
                <input
                  #input
                  class="k-textbox"
                  style="text-align: right"
                  class="form-control"
                  [readonly]="false"
                  [formControl]="productArray.controls[rowIndex].get(column.field)"
                />
              </ng-template>
            </kendo-grid-column>
            <kendo-grid-column
              field="Description"
              title="Description"
              width="130"
            >
              <ng-template
                kendoGridCellTemplate
                let-dataItem="dataItem"
                let-column="column"
                let-formGroup="formGroup"
                let-rowIndex="rowIndex"
              >
                <input
                  #input
                  class="k-textbox"
                  style="text-align: right"
                  class="form-control"
                  [readonly]="false"
                  [formControl]="productArray.controls[rowIndex].get(column.field)"
                />
              </ng-template>
            </kendo-grid-column>
            <kendo-grid-column field="Quantity" title="Quantity" width="100">
              <ng-template
                kendoGridCellTemplate
                let-dataItem="dataItem"
                let-column="column"
                let-formGroup="formGroup"
                let-isNew="isNew"
                let-column="column"
                let-rowIndex="rowIndex"
              >
                <kendo-numerictextbox
                  popupAnchor
                  class="form-control"
                  [format]="'n0'"
                  [min]="1"
                  [formControl]="productArray.controls[rowIndex].get(column.field)"
                >
                </kendo-numerictextbox>
              </ng-template>
              <ng-template
                kendoGridFooterTemplate
                let-column
                let-columnIndex="columnIndex"
              >
                <span class="pull-right"> Total QTY:{{ calTotalQty()}} </span>
              </ng-template>
            </kendo-grid-column>
            <kendo-grid-command-column title="Action" width="60">
              <ng-template kendoGridCellTemplate let-isNew="isNew">
                <button kendoGridRemoveCommand>
                  <i
                    class="fas fa-trash-alt mr-2 cursor-pointer"
                    tooltip="Delete"
                  ></i>
                </button>
              </ng-template>
            </kendo-grid-command-column>
          </kendo-grid>
          <div *ngIf="listLoading" class="k-i-loading"></div>
        </div>
      </div>
    </div>

    <div class="col-md-12">
      <div class="col-md-4">
        <div class="form-group">
          <label>Remarks</label>
          <input formControlName="Remarks" type="text" class="form-control" />
        </div>
      </div>
    </div>
    <div class="col-md-12">
      <div class="col-sm-2">
        <div class="form-group">
          <div class="checkbox">
            <label> <input type="checkbox" />Do not close </label>
          </div>
        </div>
      </div>
      <div class="col-sm-2">
        <div class="form-group">
          <div class="checkbox">
            <label> <input type="checkbox" />Print while saving </label>
            <!-- <button [routerLink]="['invoice-billing']" class="btn btn-primary">
            Print Invoice
          </button> -->
          </div>
        </div>
      </div>
    </div>

    <div class="box-footer">
      <div class="mb-2">
        <button
          class="btn btn-primary"
          (click)="save()"
          accSwiftFormSubmitValidationMsg
          [validationControl]="deliveryNotesForm"
        >
          <i class="fas fa-save"></i>&nbsp;&nbsp;Save
        </button>
        <button class="btn btn-secondary ml-2">Cancel</button>
      </div>
    </div>
  </form>
</div>
