<div class="box box-default">
  <form [formGroup]="addJournalForm" novalidate>
    <div class="col-md-12 mt-5 mr-2">
      <div class="col-md-4">
        <div class="row clearfix">
          <div class="col-md-5">
            <label class="float-right">Series: </label>
          </div>
          <div class="col-md-7">
            <select
              class="form-control"
              id="seriesId"
              formControlName="seriesName"
            >
              <option *ngFor="let series of journalService.journalSeriesList"
                >{{ series.EngName }}
              </option>
            </select>
          </div>
        </div>
        <div class="row clearfix mt-3">
          <div class="col-md-5">
            <label class="float-right">Project: </label>
          </div>
          <div class="col-md-7">
            <select
              class="form-control"
              id="projectId"
              formControlName="projectName"
            >
              <option *ngFor="let project of journalService.projectLists">
                {{ project.EngName }}</option
              >
            </select>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="row clearfix">
          <div class="col-md-5">
            <label class="float-right">Voucher #: </label>
          </div>
          <div class="col-md-7">
            <input class="form-control" formControlName="voucherNo" />
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="row clearfix">
          <div class="col-md-5">
            <label class="float-right">Date :</label>
          </div>
          <div class="col-md-7">
            <input
              formControlName="date"
              type="date"
              class="form-control"
            />
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-12 mt-5 ml-2">
      <kendo-grid
        [data]="getjournalEntryList.value"
        (edit)="editHandler($event)"
        (cancel)="cancelHandler($event)"
        (save)="saveHandler($event)"
        (remove)="removeHandler($event)"
        (add)="addHandler($event)"
      >
        <ng-template kendoGridToolbarTemplate>
          <button kendoGridAddCommand>Add new</button>
        </ng-template>

        <kendo-grid-column
          field="ledgerCode"
          title="Particulars Or AccountingHead"
          width="300"
        >
          <ng-template
            kendoGridCellTemplate
            let-dataItem="dataItem"
            let-column="column"
            let-formGroup="formGroup"
            let-isNew="isNew"
            let-rowIndex="rowIndex"
          >
            <div class="col-xs-12 col-md-12 p-0">
              <div class="col-md-4 pl-0">
                <input
                  #input
                  class="k-textbox"
                  style="width: 100px"
                  placeholder="Ledger Code"
                  [formControl]="
                    getjournalEntryList.controls[rowIndex].get('ledgerCode')
                  "
                  (change)="changeLedgerValue(dataItem, rowIndex)"
                />
                <kendo-popup
                  [anchor]="input"
                  *ngIf="
                    getjournalEntryList.controls[rowIndex].get('ledgerCode')
                      .invalid
                  "
                  popupClass="k-widget k-tooltip k-tooltip-validation k-invalid-msg"
                >
                  <span class="k-icon k-i-warning"></span>
                  Ledger Code is invalid
                </kendo-popup>
              </div>
              <div class="col-md-8 pr-0">
                <input
                  #input
                  class="k-textbox"
                  [readonly]="true"
                  [formControl]="
                    getjournalEntryList.controls[rowIndex].get(
                      'particularsOraccountingHead'
                    )
                  "
                />
                <a
                  href="#"
                  (click)="openModal(rowIndex)"
                  data-toggle="modal"
                  data-target="#ledgerSelectModal"
                  ><i
                    class="fa fa-eye pull-right ledgerSelectIcon"
                    aria-hidden="true"
                  ></i>
                </a>
                <kendo-popup
                  [anchor]="input"
                  *ngIf="
                    getjournalEntryList.controls[rowIndex].get(
                      'particularsOraccountingHead'
                    ).invalid &&
                    rowSubmitted &&
                    !(
                      isNew &&
                      getjournalEntryList.controls[rowIndex].get(
                        'particularsOraccountingHead'
                      ).untouched
                    )
                  "
                  popupClass="k-widget k-tooltip k-tooltip-validation k-invalid-msg"
                >
                  <span class="k-icon k-i-warning"></span>
                  Ledger name is required
                </kendo-popup>
              </div>
            </div>
          </ng-template>
        </kendo-grid-column>

        <kendo-grid-column field="debit" title="Debit" width="150">
          <ng-template
            kendoGridCellTemplate
            let-dataItem="dataItem"
            let-column="column"
            let-formGroup="formGroup"
            let-isNew="isNew"
            let-rowIndex="rowIndex"
          >
            <kendo-numerictextbox
              #ntb="popupAnchor"
              popupAnchor
              style="width: 130px"
              [format]= "'c0'"
              [decimals]="decimals"
              [formControl]="
                getjournalEntryList.controls[rowIndex].get(column.field)
              "
              (change)="checkDebitValue(dataItem, rowIndex)"
            ></kendo-numerictextbox>

            <kendo-popup
              [anchor]="ntb.element"
              *ngIf="
                getjournalEntryList.controls[rowIndex].get('debit').invalid &&
                rowSubmitted
              "
              popupClass="k-widget k-tooltip k-tooltip-validation k-invalid-msg"
            >
              <span class="k-icon k-i-warning"></span>
              Debit Amount is required
            </kendo-popup>
          </ng-template>
          <ng-template
            kendoGridFooterTemplate
            let-column
            let-columnIndex="columnIndex"
          >
            <span class="float-right">
              Debit Total: {{ debitTotal | currencyFormat }}
            </span>
          </ng-template>
        </kendo-grid-column>

        <kendo-grid-column field="credit" title="Credit" width="150">
          <ng-template
            kendoGridCellTemplate
            let-dataItem="dataItem"
            let-column="column"
            let-formGroup="formGroup"
            let-isNew="isNew"
            let-rowIndex="rowIndex"
          >
            <kendo-numerictextbox
              #ntb="popupAnchor"
              popupAnchor
              style="width: 130px"
              [decimals]="decimals"
              [format]= "'c0'"
              [formControl]="
                getjournalEntryList.controls[rowIndex].get('credit')
              "
              (change)="checkCreditValue(dataItem, rowIndex)"
            ></kendo-numerictextbox>

            <kendo-popup
              [anchor]="ntb.element"
              *ngIf="
                getjournalEntryList.controls[rowIndex].get('credit').invalid &&
                rowSubmitted &&
                !(
                  isNew &&
                  getjournalEntryList.controls[rowIndex].get('credit').untouched
                )
              "
              popupClass="k-widget k-tooltip k-tooltip-validation k-invalid-msg"
            >
              <span class="k-icon k-i-warning"></span>
              Credit Amount is required
            </kendo-popup>
          </ng-template>
          <ng-template
            kendoGridFooterTemplate
            let-column
            let-columnIndex="columnIndex"
          >
            <span class="float-right"> Credit Total: {{ creditTotal }} </span>
          </ng-template>
        </kendo-grid-column>

        <kendo-grid-column field="balance" title="Balance" width="150">
          <ng-template
            kendoGridCellTemplate
            let-dataItem="dataItem"
            let-column="column"
            let-formGroup="formGroup"
            let-isNew="isNew"
            let-rowIndex="rowIndex"
          >
            <kendo-numerictextbox
              #ntb="popupAnchor"
              popupAnchor
              style="width:130px"
              [readonly]="true"
              [decimals]="decimals"
              [format]="'c0'"
              [formControl]="
                getjournalEntryList.controls[rowIndex].get(column.field)
              "
            ></kendo-numerictextbox>
          </ng-template>
          <ng-template
            kendoGridFooterTemplate
            let-column
            let-columnIndex="columnIndex"
          >
            <span class="float-right">
              Difference : {{  ( debitTotal - creditTotal ) | currencyFormat }}
            </span>
          </ng-template>
        </kendo-grid-column>

        <kendo-grid-column field="remarks" title="Remarks" width="150">
          <ng-template
            kendoGridCellTemplate
            let-dataItem="dataItem"
            let-column="column"
            let-formGroup="formGroup"
            let-isNew="isNew"
            let-rowIndex="rowIndex"
          >
            <input
              #ntb="popupAnchor"
              popupAnchor
              style="width:130px"
              [formControl]="
                getjournalEntryList.controls[rowIndex].get('remarks')
              "
            />
          </ng-template>
        </kendo-grid-column>

        <kendo-grid-command-column title="Action" width="100">
          <ng-template kendoGridCellTemplate let-isNew="isNew">
            <button class="k-button" kendoGridAddCommand>
              <i
                class="fa fa-plus cursor-pointer"
                aria-hidden="true"
                tooltip="Add New"
              ></i>
            </button>
            <button kendoGridRemoveCommand>
              <i
                class="fas fa-trash-alt mr-2 cursor-pointer"
                tooltip="Delete"
              ></i>
            </button>
            <button kendoGridSaveCommand [primary]="true">
              {{ isNew ? "Add" : "Update" }}
            </button>
            <button kendoGridCancelCommand>
              {{ isNew ? "Discard changes" : "Cancel" }}
            </button>
          </ng-template>
        </kendo-grid-command-column>
      </kendo-grid>
    </div>
    <div class="col-md-12 mt-2 ml-2 clearfix">
      <div class="col-md-2">
        <label class="float-right">Narration :</label>
      </div>
      <div class="col-md-8">
        <input formControlName="narration" type="text" class="form-control" />
      </div>
      <div class="col-md-2"></div>
    </div>
    <div class="col-md-12 mt-2 ml-2 clearfix">
      <div class="col-md-2">
        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="donotClose" />
          <label class="form-check-label" for="donotClose">Do not close</label>
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="printonSaving" />
          <label class="form-check-label" for="printonSaving"
            >Print while saving</label
          >
        </div>
      </div>
      <div class="col-md-3">
        <button type="submit" class="btn btn-block btn-default" disabled>
          <i class="fa fa-plus" aria-hidden="true"></i>Group Voucher Posting
        </button>
      </div>
    </div>
    <div class="col-md-12 m-2">
      <button class="btn btn-primary" disabled (click)="save()">Save</button>
      <button class="btn btn-secondary ml-2" (click)="cancel()">
        Cancel
      </button>
    </div>
  </form>
</div>
<!--Modal Popup-->
<div
  class="modal fade bd-example-modal-lg"
  #ledgerSelectModal
  id="ledgerSelectModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg" role="document" style="max-width: 870px;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Select Ledger</h5>
        <button
          class="close"
          type="button"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <div class="row mt-2">
            <div class="grid-wrapper">
              <kendo-grid
                [kendoGridBinding]="ledgerList"
                [filterable]="true"
                [pageSize]="pageSize"
                [skip]="skip"
                [sortable]="{
                  allowUnsort: allowUnsort,
                  mode: 'single'
                }"
                [sort]="sort"
                (sortChange)="sortChange($event)"
                [pageable]="true"
                (pageChange)="pageChange($event)"
                scrollable="none"
                (selectedKeysChange)="
                  onSelectedKeysChange($event, selectedLedgerRow)
                "
                [kendoGridSelectBy]="'LedgerID'"
                [selectedKeys]="mySelection"
              >
                <kendo-grid-column
                  field="LedgerName"
                  title="Ledger Name"
                  width="350"
                >
                  <ng-template
                    kendoGridCellTemplate
                    let-dataItem="dataItem"
                    let-rowIndex="rowIndex"
                  >
                    <a
                      class="a_link"
                      (click)="selectedLedger(dataItem, selectedLedgerRow)"
                      >{{ dataItem.LedgerName }}</a
                    >
                  </ng-template>
                </kendo-grid-column>
                <kendo-grid-column
                  field="LedgerCode"
                  title="Ledger Code"
                  width="180"
                >
                </kendo-grid-column>
                <kendo-grid-column
                  field="ActualBalance"
                  title="Actual Balance"
                  width="180"
                >
                  <ng-template kendoGridCellTemplate let-dataItem="dataItem">
                    <span class="float-right">{{
                      dataItem.ActualBalance
                    }}</span>
                  </ng-template>
                </kendo-grid-column>
                <kendo-grid-column
                  field="LedgerType"
                  title="Ledger Type"
                  width="150"
                ></kendo-grid-column>
              </kendo-grid>

              <div *ngIf="ledgerListLoading" class="k-i-loading"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>
